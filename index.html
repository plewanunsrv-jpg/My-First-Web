<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meeting Action Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans Thai', sans-serif; background-color: #f3f4f6; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Plus, Calendar, User, CheckCircle2, Circle, Save, Trash2, Layout, Clock, FileText, ChevronRight } = lucide;

        // URL API ที่คุณให้มา
        const API_URL = "https://script.google.com/macros/s/AKfycbz1u9m2ChAxblJAMz7T3z53rKuEgSsT5jV3U0FZJK0y1mm-9JX8hd5-khx5LRUO89KF/exec";

        const App = () => {
            const [tasks, setTasks] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [isModalOpen, setIsModalOpen] = useState(false);

            // 1. ฟังก์ชันดึงข้อมูลจาก Google Sheets
            const fetchTasks = async () => {
                setIsLoading(true);
                try {
                    const response = await fetch(API_URL);
                    const data = await response.json();
                    setTasks(data);
                } catch (error) {
                    console.error("Error fetching data:", error);
                } finally {
                    setIsLoading(false);
                }
            };

            useEffect(() => {
                fetchTasks();
            }, []);

            // 2. ฟังก์ชันบันทึกข้อมูลลง Google Sheets
            const handleSaveAll = async () => {
                if (pendingTasks.length === 0) return;

                setIsLoading(true);
                try {
                    await fetch(API_URL, {
                        method: 'POST',
                        mode: 'no-cors', // สำคัญสำหรับ Google Apps Script
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(pendingTasks)
                    });
                    
                    // หลังจากบันทึก ให้ดึงข้อมูลใหม่มาโชว์ทันที
                    setTimeout(() => {
                        fetchTasks();
                        setIsModalOpen(false);
                        setPendingTasks([]);
                        setMeetingTopic("");
                    }, 1000);

                } catch (error) {
                    alert("เกิดข้อผิดพลาดในการบันทึก");
                    console.error(error);
                } finally {
                    setIsLoading(false);
                }
            };

            // ... (โค้ดส่วนการจัดการ State ของ Form และ UI อื่นๆ ให้ใช้ตามไฟล์ต้นฉบับของคุณได้เลย)
            // หมายเหตุ: ตรวจสอบให้แน่ใจว่าชื่อ Field ใน JSON (เช่น task, assignee) ตรงกับหัว Column ใน Google Sheet
            
            return (
                <div className="min-h-screen p-4 md:p-8">
                    {/* ส่วน UI แสดงผลตาราง และปุ่มกดเปิด Modal */}
                    {isLoading ? <div className="text-center">กำลังโหลดข้อมูล...</div> : (
                        /* Render ตารางข้อมูลจาก tasks state */
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
