<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meeting Action Tracker</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Noto Sans Thai', sans-serif; background-color: #f3f4f6; [cite: 231, 232]}
        .custom-scrollbar::-webkit-scrollbar { width: 8px; [cite: 233]}
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; [cite: 234]}
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; [cite: 234, 235]}
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } [cite: 236, 237, 238]}
        .animate-fade-in-up { animation: fadeIn 0.3s ease-out forwards; [cite: 239]}
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // ดึง Icons จาก Lucide
        const { Plus, Trash2, CheckCircle, Clock, AlertTriangle, Calendar: CalendarIcon, Search, Save, X: XIcon, Filter: FilterIcon, ListPlus, User } = lucide; [cite: 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254]

        const API_URL = "https://script.google.com/macros/s/AKfycbz1u9m2ChAxblJAMz7T3z53rKuEgSsT5jV3U0FZJK0y1mm-9JX8hd5-khx5LRUO89KF/exec";

        const App = () => {
            const [tasks, setTasks] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [filterText, setFilterText] = useState(""); [cite: 264]
            const [statusFilter, setStatusFilter] = useState("all"); [cite: 264]
            const [isModalOpen, setIsModalOpen] = useState(false); [cite: 264]
            const [pendingTasks, setPendingTasks] = useState([]); [cite: 267]
            
            const [meetingInfo, setMeetingInfo] = useState({
                topic: "",
                date: new Date().toISOString().split('T')[0]
            }); [cite: 265]

            const [currentTask, setCurrentTask] = useState({
                task: "",
                assignee: "",
                startDate: new Date().toISOString().split('T')[0],
                dueDate: ""
            }); [cite: 266]

            // ฟังก์ชันดึงข้อมูล
            const fetchTasks = async () => {
                try {
                    const response = await fetch(API_URL);
                    const data = await response.json();
                    setTasks(data);
                } catch (error) {
                    console.error("Fetch error:", error);
                } finally {
                    setIsLoading(false);
                }
            };

            useEffect(() => { fetchTasks(); }, []);

            const getStatus = (task) => {
                if (task.isCompleted) return { type: "completed", status: "เสร็จสิ้น", color: "bg-green-100 text-green-800 border-green-300", icon: <CheckCircle size={16} /> }; [cite: 267]
                const today = new Date();
                today.setHours(0, 0, 0, 0); [cite: 268]
                const due = new Date(task.dueDate);
                const diffDays = Math.ceil((due - today) / (1000 * 60 * 60 * 24)); [cite: 268, 269]
                if (diffDays < 0) return { type: "overdue", status: "เลยกำหนด", color: "bg-red-100 text-red-800 border-red-300", icon: <AlertTriangle size={16} /> }; [cite: 270]
                if (diffDays <= 3) return { type: "warning", status: "ใกล้ถึงกำหนด", color: "bg-yellow-100 text-yellow-800 border-yellow-300", icon: <Clock size={16} /> }; [cite: 271]
                return { type: "inprogress", status: "ดำเนินการอยู่", color: "bg-blue-900 text-white border-blue-800", icon: <Clock size={16} /> }; [cite: 272]
            };

            const handleSaveAll = async () => {
                if (pendingTasks.length === 0) return; [cite: 281]
                setIsLoading(true);
                try {
                    const formData = new URLSearchParams();
                    formData.append('data', JSON.stringify(pendingTasks));

                    await fetch(API_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: formData.toString()
                    });
                    
                    setTimeout(() => {
                        fetchTasks();
                        setIsModalOpen(false);
                        setPendingTasks([]);
                        setMeetingInfo({ topic: "", date: new Date().toISOString().split('T')[0] }); [cite: 282]
                    }, 1500);
                } catch (error) {
                    alert("บันทึกไม่สำเร็จ");
                    setIsLoading(false);
                }
            };

            // ส่วน UI และการจัดการ Form (คงเดิมจากไฟล์ต้นฉบับ)
            const addPendingTask = () => {
                if (!currentTask.task || !currentTask.dueDate) return; [cite: 276]
                const newItem = { id: Date.now(), meetingTopic: meetingInfo.topic, meetingDate: meetingInfo.date, ...currentTask, isCompleted: false }; [cite: 277, 278]
                setPendingTasks([...pendingTasks, newItem]); [cite: 279]
                setCurrentTask({ task: "", assignee: "", startDate: new Date().toISOString().split('T')[0], dueDate: "" }); [cite: 279, 280]
            };

            const filteredTasks = tasks.filter(t => {
                const matchesSearch = t.meetingTopic?.toLowerCase().includes(filterText.toLowerCase()) || t.task?.toLowerCase().includes(filterText.toLowerCase()); [cite: 286]
                const { type } = getStatus(t);
                return matchesSearch && (statusFilter === "all" || type === statusFilter); [cite: 287]
            });

            return (
                <div className="min-h-screen bg-gray-50 p-4 md:p-8">
                    <div className="max-w-7xl mx-auto space-y-6">
                        <header className="flex justify-between items-center mb-6">
                            <h1 className="text-3xl font-bold text-gray-800 flex items-center gap-2">
                                <CalendarIcon className="text-blue-600" /> Meeting Tracker [cite: 290, 291]
                            </h1>
                            <button onClick={() => setIsModalOpen(true)} className="bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 shadow-md">
                                <Plus size={20} /> บันทึกข้อมูล [cite: 294, 295]
                            </button>
                        </header>

                        {/* Search & Filter */}
                        <div className="flex flex-col md:row gap-3">
                            <input type="text" placeholder="ค้นหา..." value={filterText} onChange={(e) => setFilterText(e.target.value)} className="flex-1 p-3 border rounded-xl" /> [cite: 304, 305, 306]
                        </div>

                        {/* Table */}
                        <div className="bg-white rounded-xl shadow-sm overflow-hidden">
                            <table className="w-full text-left">
                                <thead className="bg-gray-50 border-b">
                                    <tr>
                                        <th className="p-4">รายละเอียดงาน</th>
                                        <th className="p-4 text-center">กำหนดส่ง</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {isLoading ? <tr><td colSpan="2" className="p-10 text-center">กำลังโหลด...</td></tr> : 
                                        filteredTasks.map(item => {
                                            const { status, color, icon } = getStatus(item); [cite: 324]
                                            return (
                                                <tr key={item.id} className="border-b">
                                                    <td className="p-4">
                                                        <div className="font-bold">{item.task}</div> [cite: 332]
                                                        <div className="text-xs text-gray-500">{item.meetingTopic}</div> [cite: 334]
                                                        <div className={`mt-1 inline-block px-2 py-0.5 rounded text-xs ${color}`}>{icon} {status}</div> [cite: 336, 337]
                                                    </td>
                                                    <td className="p-4 text-center text-sm">{item.dueDate}</td> [cite: 342]
                                                </tr>
                                            );
                                        })
                                    }
                                </tbody>
                            </table>
                        </div>

                        {/* Modal (Action Item Form) */}
                        {isModalOpen && (
                            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto">
                                    <h2 className="text-xl font-bold mb-4">บันทึกงานใหม่</h2>
                                    <input type="text" placeholder="หัวข้อประชุม" name="topic" value={meetingInfo.topic} onChange={(e) => setMeetingInfo({...meetingInfo, topic: e.target.value})} className="w-full p-2 border rounded mb-4" /> [cite: 370, 372, 373]
                                    <div className="space-y-3 border-t pt-4">
                                        <input type="text" placeholder="งานที่ต้องทำ" value={currentTask.task} onChange={(e) => setCurrentTask({...currentTask, task: e.target.value})} className="w-full p-2 border rounded" /> [cite: 387, 389]
                                        <input type="date" value={currentTask.dueDate} onChange={(e) => setCurrentTask({...currentTask, dueDate: e.target.value})} className="w-full p-2 border rounded" /> [cite: 411, 412]
                                        <button onClick={addPendingTask} className="w-full bg-gray-800 text-white p-2 rounded">เพิ่มลงรายการ</button> [cite: 417, 418, 419]
                                    </div>
                                    <div className="mt-4 border-t pt-4 flex justify-end gap-2">
                                        <button onClick={() => setIsModalOpen(false)} className="px-4 py-2">ยกเลิก</button> [cite: 450, 451]
                                        <button onClick={handleSaveAll} className="bg-blue-600 text-white px-6 py-2 rounded-lg">บันทึกทั้งหมด ({pendingTasks.length})</button> [cite: 453, 454, 455]
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
